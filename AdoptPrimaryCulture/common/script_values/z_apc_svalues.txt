#-----------------------------------------------------------------------------------------
# Percentage thresholds for the currently evaluated non-primary culture to be considered a Cultural Majority, per level
#-----------------------------------------------------------------------------------------
z_apc_cultural_majority_threshold_country = { value = 0.5 }
z_apc_cultural_majority_threshold_capital_region = { value = 0.5 }
z_apc_cultural_majority_threshold_capital_area = { value = 0.5 }
z_apc_cultural_majority_threshold_capital_city = { value = 0.5 }

#-----------------------------------------------------------------------------------------
# Number of pops of the currently evaluated non-primary culture
#-----------------------------------------------------------------------------------------
z_apc_culture_A_country_population = {
	value = 0
	every_owned_province = {
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_A
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_A_capital_region_population = {
	value = 0
	every_owned_province = {
		limit = {
			this.region = root.capital_scope.region
		}
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_A
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_A_capital_area_population = {
	value = 0
	every_owned_province = {
		limit = {
			this.area = root.capital_scope.area
		}
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_A
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_A_capital_city_population = {
	value = 0
	root.capital_scope = {
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_A
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_B_country_population = {
	value = 0
	every_owned_province = {
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_B
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_B_capital_region_population = {
	value = 0
	every_owned_province = {
		limit = {
			this.region = root.capital_scope.region
		}
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_B
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_B_capital_area_population = {
	value = 0
	every_owned_province = {
		limit = {
			this.area = root.capital_scope.area
		}
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_B
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

z_apc_culture_B_capital_city_population = {
	value = 0
	root.capital_scope = {
		every_pops_in_province = {
			if = {
				limit = {
					this.country_culture = scope:z_apc_culture_B
					#NOT = { pop_type = slaves }
				}
				add = 1
			}
		}
	}
}

#-----------------------------------------------------------------------------------------
# Number of pops, per level (to be cached so it's only calculated once)
#-----------------------------------------------------------------------------------------
z_apc_total_population_in_country = {
	value = root.country_population # Not strictly necessary, but this for exhaustiveness
}

z_apc_total_population_in_capital_region = {
	value = 0
	root.capital_scope.region = {
		every_region_province = {
			limit = {
				has_owner = yes
				owner = root
			}
			add = total_population
		}
	}
}

z_apc_total_population_in_capital_area = {
	value = 0
	root.capital_scope.area = {
		every_area_province = {
			limit = {
				has_owner = yes
				owner = root
			}
			add = total_population
		}
	}
}

z_apc_total_population_in_capital_city = {
	value = root.capital_scope.total_population # Not strictly necessary, but this for exhaustiveness
}

#-----------------------------------------------------------------------------------------
# Percentages of pops from the currently evaluated non-primary culture, per level
#-----------------------------------------------------------------------------------------
z_apc_culture_pc_country = {
	value = 0
	if = {
		limit = {
			var:z_apc_total_population_in_country_cache > 0
		}
		add = var:z_apc_culture_A_country_population_cache
		divide = var:z_apc_total_population_in_country_cache
	}
}

z_apc_culture_pc_capital_region = {
	value = 0
	if = {
		limit = {
			var:z_apc_total_population_in_capital_region_cache > 0
		}
		add = var:z_apc_culture_A_capital_region_population_cache
		divide = var:z_apc_total_population_in_capital_region_cache
	}
}

z_apc_culture_pc_capital_area = {
	value = 0
	if = {
		limit = {
			var:z_apc_total_population_in_capital_area_cache > 0
		}
		add = var:z_apc_culture_A_capital_area_population_cache
		divide = var:z_apc_total_population_in_capital_area_cache
	}
}

z_apc_culture_pc_capital_city = {
	value = 0
	if = {
		limit = {
			var:z_apc_total_population_in_capital_city_cache > 0
		}
		add = var:z_apc_culture_A_capital_city_population_cache
		divide = var:z_apc_total_population_in_capital_city_cache
	}
}

#-----------------------------------------------------------------------------------------
# Svalues that return vars, since comparing two vars returns illegal operator error
#-----------------------------------------------------------------------------------------
z_apc_culture_A_country_population_cache = { value = var:z_apc_culture_A_country_population_cache }
z_apc_culture_A_capital_region_population_cache = { value = var:z_apc_culture_A_capital_region_population_cache }
z_apc_culture_A_capital_area_population_cache = { value = var:z_apc_culture_A_capital_area_population_cache }
z_apc_culture_A_capital_city_population_cache = { value = var:z_apc_culture_A_capital_city_population_cache }
z_apc_culture_B_country_population_cache = { value = var:z_apc_culture_B_country_population_cache }
z_apc_culture_B_capital_region_population_cache = { value = var:z_apc_culture_B_capital_region_population_cache }
z_apc_culture_B_capital_area_population_cache = { value = var:z_apc_culture_B_capital_area_population_cache }
z_apc_culture_B_capital_city_population_cache = { value = var:z_apc_culture_B_capital_city_population_cache }

#-----------------------------------------------------------------------------------------
# Cultural Transition (minimal score to finish the mission tree and proceed with cultural conversion)
#-----------------------------------------------------------------------------------------
z_apc_mission_ctp_min_svalue = { value = 20 }

#-----------------------------------------------------------------------------------------
# Cultural Transition (current score)
#-----------------------------------------------------------------------------------------
z_apc_mission_ctp_current_svalue = {
	value = 0
	if = {
		limit = { has_variable = z_apc_mission_ctp_current }
		add = var:z_apc_mission_ctp_current
	}
}

#-----------------------------------------------------------------------------------------
# Cultural Transition (max possible score)
#-----------------------------------------------------------------------------------------
z_apc_mission_ctp_max_svalue = {
	value = 0 # Base (total: 28)
	# From mission tasks (total: 22)
	add = 3 # From z_apc_mission_integrate_citizens
	add = 2 # From z_apc_mission_npc_exception
	add = 2 # From z_apc_mission_integrate_nobles
	add = 3 # From z_apc_mission_npc_government
	add = 2 # From z_apc_mission_npc_governors
	add = 2 # From z_apc_mission_npc_army
	add = 3 # From z_apc_mission_npc_ruler
	add = 2 # From z_apc_mission_npc_city
	add = 3 # From z_apc_mission_npc_capital
	# From events (total: 6)
	add = 1 # From z_apc_mission.3
	add = 1 # From z_apc_mission.4
	add = 1 # From z_apc_mission.5
	add = 1 # From z_apc_mission.6
	add = 1 # From z_apc_mission.7
	add = 1 # From z_apc_mission.8	
}

#-----------------------------------------------------------------------------------------
# Mission task - Governors
#-----------------------------------------------------------------------------------------
# Number of governors required to complete mission
z_apc_mission_npc_governors_threshold_svalue = {
	value = 0
	every_governorships = { add = 1 }
	subtract = 1 # Minus the capital region
	divide = 4
	min = 1
	ceiling = yes
}

# Current number of governors matching the requirement
z_apc_mission_npc_governors_current_svalue = {
	value = 0
	every_character = {
		limit = {
			is_alive = yes
			is_ruler = no
			is_governor = yes
			has_culture = scope:z_apc_new_primary_pop_culture
		}
		add = 1
	}
}

# Actual number required
z_apc_mission_npc_governors_goal_svalue = {
	value = 0
	add = z_apc_mission_npc_governors_threshold_svalue
	add = 1
}

#-----------------------------------------------------------------------------------------
# Mission task - Office holders
#-----------------------------------------------------------------------------------------
# Number of office holders required to complete mission
z_apc_mission_npc_government_threshold_svalue = {
	value = 4
}

# Current number of office holders matching the requirement
z_apc_mission_npc_government_current_svalue = {
	value = 0
	every_character = {
		limit = {
			is_alive = yes
			is_ruler = no
			has_any_office = yes
			has_culture = scope:z_apc_new_primary_pop_culture
		}
		add = 1
	}
}

# Actual number required
z_apc_mission_npc_government_goal_svalue = {
	value = 0
	add = z_apc_mission_npc_government_threshold_svalue
	add = 1
}

#-----------------------------------------------------------------------------------------
# Mission task - Legion commanders
#-----------------------------------------------------------------------------------------
# Number of legion commanders required to complete mission
z_apc_mission_npc_army_threshold_svalue = {
	value = 0
	every_legion = { add = 4 } # 4 Commanders per Legion
	divide = 2
	min = 1
	ceiling = yes
}

# Current number of legion commanders matching the requirement
z_apc_mission_npc_army_current_svalue = {
	value = 0
	every_legion = {
		every_legion_commander = {
			limit = {
				has_culture = scope:z_apc_new_primary_pop_culture
			}
			add = 1
		}
	}
}

# Actual number required
z_apc_mission_npc_army_goal_svalue = {
	value = 0
	add = z_apc_mission_npc_army_threshold_svalue
	add = 1
}

#-----------------------------------------------------------------------------------------
# Total number of events for converting and recruiting new characters - Calculated once after finishing the first mission task
#-----------------------------------------------------------------------------------------
z_apc_character_generation_amount = {
	value = 0
	# Match exactly the number required
	add = z_apc_mission_npc_governors_goal_svalue
	subtract = z_apc_mission_npc_governors_current_svalue
	add = z_apc_mission_npc_government_goal_svalue
	subtract = z_apc_mission_npc_government_current_svalue
	add = z_apc_mission_npc_army_goal_svalue
	subtract = z_apc_mission_npc_army_current_svalue
	# Add some for free
	add = 2
}